<link rel="import" href="../polymer/polymer.html">

<script>
/**
* Behavior that highlights stuff.
*
* @polymerBehavior
*/
    InstrumentButtonBehavior= {
        properties:{
            insrumentOpacity:{
                type:Number,
                value:1
            },
            instrumentEventQueue: {
                type: Array,
                value: []
            },
            showingInstrumentNotes:{
                type:Boolean,
                value:false
            },
            instrumentState: {
                type: Number,
                value:0
            },
            playbackOpacity:{
                type:Number,
                value:1
            },
            playbackEventQueue: {
                type: Array,
                value: []
            },
            showingPlaybackNotes:{
                type:Boolean,
                value:false
            },
            playbackState: {
                type: Number,
                value:0
            }
        },
        _getNoteName: function(note){
            var notes = [
                'C',
                'C#',
                'D',
                'Eb',
                'E',
                'F',
                'F#',
                'G',
                'Ab',
                'A',
                'Bb',
                'B'
            ];
            var octave = Math.floor(note / 12);
            var name = notes[note % 12];
            name += octave;
            return name;
        },
        update: function () {
            var next;
            while (this.playbackEventQueue.length > 0) {
                next = this.playbackEventQueue[this.playbackEventQueue.length - 1];
                if (next.detail.time < context.currentTime) {
                    this.playbackState = next.detail.buttonState;
                    this.playbackEventQueue.pop();
                } else {
                    break;
                }
            }
            while (this.instrumentEventQueue.length > 0) {
                next = this.instrumentEventQueue[this.instrumentEventQueue.length - 1];
                if (next.detail.time < context.currentTime) {
                    this.instrumentState = next.detail.buttonState;
                    this.instrumentEventQueue.pop();
                } else {
                    break;
                }
            }
        },
        resetGUI: function(origin,clearState){
            if(origin==='playback') {
                // this.async(function(){
                    this.playbackEventQueue = [] ;
                    if(clearState)
                        this.playbackState = 0 ;
                // }.bind(clearState) , 0 )  ;
            }
            if(origin==='instrument') {
                // this.async(function(){
                    this.instrumentEventQueue = [] ;
                    if(clearState)
                        this.instrumentState = 0 ;
                // }.bind(clearState) , 0 )  ;
            }
        },
        addButtonAction: function (e) {
            if (e.detail.origin === 'playback' || e.detail.origin==='playbackGUI')
                this.playbackEventQueue.unshift(e);
            if (e.detail.origin === 'instrument') {
                this.instrumentEventQueue.unshift(e);
            }
        },
        ready: function () {
            this.playbackEventQueue = [];
            this.instrumentEventQueue = [];
        }
    } ;
</script>
