<link rel="import" href="../polymer/polymer.html">

<script>
/**
* Behavior that highlights stuff.
*
* @polymerBehavior
*/
    InstrumentButtonsBehavior= {
        listeners:{'note-load':'_onNoteLoad'},
        properties:{
            name:{
                type:String
            },
            loadingId:{
                type:Number,
                value:0
            },
            finishedLoading:{
                type:Boolean,
                value:false
            },
            rotation:{
                type:Boolean,
                value:false
            },
            instrumentPanning:{
                type:Number,
                value:0,
                observer:'_setSynthInstrumentPanning'
            },
            playbackPanning:{
                type:Number,
                value:0,
                observer:'_setSynthPlaybackPanning'
            },
            instrumentVolume:{
                type:Number,
                value:1,
                observer:'_setSynthInstrumentVolume'
            },
            playbackVolume:{
                type:Number,
                value:1,
                observer:'_setSynthPlaybackVolume'
            },
            changingPitch: {
                type: Boolean,
                value: false
            },
            notesLoaded:{
                type:Number,
                value:0
            },
            instrumentNotes:{
                type:Number,
                value:0
            },
            showingNotes:{
                type:Boolean,
                value:false
            }
        },
        _computeRotation: function(rotation){
            if( rotation )
                return "reversedHorizontal" ;
            return "horizontal" ;
        },
        _computeColRotation: function(rotation){
            if( rotation )
                return "reversedVertical" ;
            return "vertical" ;
        },
        _loadInstrumentNotes: function( loadFunction ){
            this.async(function(){
                loadFunction.call(this) ;
            } , 0 )  ;
            var d = new Date();
            var id = d.getTime();
            this.loadingId = id ;
            this.notesLoaded = 0 ;
            this.finishedLoading = false ;
        },
        _loadNote: function(synthId,note){
            this.$$('#'+synthId).loadNote(note,this.loadingId);
        },
        _onNoteLoad: function(e){
            if(e.detail.id!==this.loadingId)
                return;
            this.notesLoaded ++ ;
            if(this.notesLoaded===this.instrumentNotes) {
                this.finishedLoading = true ;
                this.fire('notes-loaded') ;
            }
        },
        onFinishedLoadingNotes: function(){
        },
        _setPitch: function(){

        },
        addPitch: function(diff){
            this.async(function(){
                this._setPitch(diff) ;
            } , 5 )  ;
            this.async(function(){
                this._loadInstrumentNotes(this._loadNotes) ;
            } , 0 )  ;
        },
        update: function(){
            var nodeList = Polymer.dom(this.root).querySelectorAll('[button]');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].update() ;
            }
        },
        reportInstrument: function(){
            this.fire('update-instrument',{name:this.name,playbackVolume:this.playbackVolume*100,instrumentVolume:this.instrumentVolume*100,instrumentPanning:this.instrumentPanning*100,playbackPanning:this.playbackPanning*100}) ;
        },
        toggleNotesOnButtons: function(which,value){
            var nodeList = Polymer.dom(this.root).querySelectorAll('[button]');
            for (var i = 0; i < nodeList.length; i++) {
                if(which==='playback'){
                    nodeList[i].showingPlaybackNotes = value ;
                }
                else{
                    nodeList[i].showingInstrumentNotes = value ;
                }
            }
        },
        setOpacity: function(which,opacity){
            var nodeList = Polymer.dom(this.root).querySelectorAll('[button]');
            for (var i = 0; i < nodeList.length; i++) {
                if (which==='playback')
                    nodeList[i].playbackOpacity = opacity ;
                else
                    nodeList[i].instrumentOpacity = opacity ;
            }
        },
        setVelocity: function(velocity){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].setVelocity(velocity) ;
            }
        },
        stopAudio: function(origin){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            var i ;
            for ( i = 0; i < nodeList.length; i++)
                nodeList[i].stop(origin) ;
        },
        resetGUI: function(origin,clearState){
            var nodeList = Polymer.dom(this.root).querySelectorAll('[button]');
            for ( i = 0; i < nodeList.length; i++) {
                nodeList[i].resetGUI(origin,clearState);
            }
        },
        _setSynthInstrumentPanning: function(panning){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].setInstrumentPanning(panning) ;
            }
        },
        _setSynthPlaybackPanning: function(panning){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].setPlaybackPanning(panning) ;
            }
        },
        _setSynthPlaybackVolume: function(volume){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].setPlaybackGain(volume) ;
            }
        },
        _setSynthInstrumentVolume: function(volume){
            var nodeList = Polymer.dom(this.root).querySelectorAll('AC-SYNTHESIZER');
            for (var i = 0; i < nodeList.length; i++) {
                nodeList[i].setInstrumentGain(volume) ;
            }
        }
    } ;
</script>
